<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.tailwindcss.com; font-src 'self' https://cdnjs.cloudflare.com; img-src 'self' data:; connect-src 'self' https:;">
    <title>Easy Debug</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../node_modules/xterm/css/xterm.css">
    <link rel="stylesheet" href="styles/main.css">
    <style>
        .ribbon-panel {
            @apply p-4 transition-all duration-300 ease-in-out;
        }
        .command-btn {
            @apply flex flex-col items-center p-3 rounded-md transition-colors duration-200 hover:bg-gray-600;
        }
        .command-btn span {
            @apply text-xs mt-1 text-gray-400;
        }
        .file-item {
            @apply flex items-center p-2 rounded-md hover:bg-gray-700 transition cursor-pointer;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-300 h-screen flex flex-col font-sans antialiased">
    <header class="bg-gray-800 border-b border-gray-700 shadow-md">
        <nav class="flex justify-between items-center px-6 py-3">
            <div class="flex items-center space-x-6">
                <h1 class="text-2xl font-extrabold text-blue-400">Easy Debug</h1>
                <button class="flex items-center space-x-2 px-3 py-1.5 rounded-lg bg-gray-700 hover:bg-gray-600 transition" id="new-window-btn">
                    <i class="fas fa-plus text-xs"></i>
                    <span class="text-sm text-gray-300">New Window</span>
                </button>
                <button class="flex items-center space-x-2 px-3 py-1.5 rounded-lg bg-gray-700 hover:bg-gray-600 transition" id="select-folder-btn">
                    <i class="fas fa-folder-open text-xs"></i>
                    <span class="text-sm text-gray-300">Open Folder</span>
                </button>
            </div>
            <button id="theme-toggle" aria-label="Toggle Theme" class="p-2 rounded-lg text-xl hover:bg-gray-700 transition">
                <i class="fas fa-moon text-blue-400"></i>
            </button>
        </nav>

        <div role="tablist" class="flex items-center space-x-1 p-2 bg-gray-800">
            <button class="ribbon-tab active px-4 py-2 rounded-t-lg text-sm transition-colors duration-200 text-white bg-gray-700" data-target="flutter">
                Flutter
            </button>
            <button class="ribbon-tab px-4 py-2 rounded-t-lg text-sm text-gray-400 hover:bg-gray-700 hover:text-white transition-colors duration-200" data-target="python">
                Python
            </button>
            <button class="ribbon-tab px-4 py-2 rounded-t-lg text-sm text-gray-400 hover:bg-gray-700 hover:text-white transition-colors duration-200" data-target="web">
                Web Dev
            </button>
            <button class="ribbon-tab px-4 py-2 rounded-t-lg text-sm text-gray-400 hover:bg-gray-700 hover:text-white transition-colors duration-200" data-target="git">
                Git
            </button>
            <button class="ribbon-tab px-4 py-2 rounded-t-lg text-sm text-gray-400 hover:bg-gray-700 hover:text-white transition-colors duration-200" data-target="utilities">
                Utilities
            </button>
            <button class="ribbon-tab px-4 py-2 rounded-t-lg text-sm text-gray-400 hover:bg-gray-700 hover:text-white transition-colors duration-200" data-target="cmd">
                CMD
            </button>
        </div>

        <div class="p-2">

            <div id="flutter" class="ribbon-panel flex space-x-4">
                <button class="command-btn" data-command="flutter run -d chrome --web-port 8080" title="flutter run -d chrome">
                    <i class="fas fa-globe text-blue-400"></i>
                    <span>Run in Chrome</span>
                </button>
                <button class="command-btn" data-command="flutter run -d emulator-5554" title="flutter run -d emulator">
                    <i class="fas fa-mobile-alt text-blue-400"></i>
                    <span>Run in Emulator</span>
                </button>
                <button class="command-btn" data-command="flutter clean && flutter pub get" title="flutter clean">
                    <i class="fas fa-broom text-blue-400"></i>
                    <span>Reset App</span>
                </button>
                <button class="command-btn" data-command="flutter analyze lib" title="flutter analyze">
                    <i class="fas fa-search text-blue-400"></i>
                    <span>Analyze</span>
                </button>
                <button class="command-btn" data-command="flutter build apk" title="flutter build apk">
                    <i class="fas fa-box text-blue-400"></i>
                    <span>Build</span>
                </button>
            </div>
            <div id="python" class="ribbon-panel hidden space-x-4">
                <button class="command-btn" data-command="python main.py" title="python main.py">
                    <i class="fas fa-play text-green-500"></i>
                    <span>Run Script</span>
                </button>
                <button class="command-btn" data-command="pip install -r requirements.txt" title="pip install -r requirements.txt">
                    <i class="fas fa-download text-green-500"></i>
                    <span>Install Deps</span>
                </button>
                <button class="command-btn" data-command="pytest" title="pytest">
                    <i class="fas fa-flask text-green-500"></i>
                    <span>Run Tests</span>
                </button>
                <button class="command-btn" data-command="flake8" title="pylint main.py">
                    <i class="fas fa-check-circle text-green-500"></i>
                    <span>Linting</span>
                </button>
            </div>
            <div id="web" class="ribbon-panel hidden space-x-4">
                <button class="command-btn" data-command="npm run dev" title="npm run dev">
                    <i class="fas fa-code text-yellow-500"></i>
                    <span>npm run dev</span>
                </button>
                <button class="command-btn" data-command="npm install" title="npm install">
                    <i class="fas fa-arrow-alt-circle-down text-yellow-500"></i>
                    <span>npm install</span>
                </button>
                <button class="command-btn" data-command="npm run build" title="npm run build">
                    <i class="fas fa-hammer text-yellow-500"></i>
                    <span>npm build</span>
                </button>
                <button class="command-btn" data-command="npm test" title="npm test">
                    <i class="fas fa-flask text-yellow-500"></i>
                    <span>npm test</span>
                </button>
            </div>
            <div id="git" class="ribbon-panel hidden space-x-4">
                <button class="command-btn" data-command="git status" title="git status">
                    <i class="fas fa-info-circle text-purple-400"></i>
                    <span>Status</span>
                </button>
                <button class="command-btn" data-command="git pull" title="git pull">
                    <i class="fas fa-arrow-down text-purple-400"></i>
                    <span>Pull</span>
                </button>
                <button class="command-btn" data-command="git push" title="git push">
                    <i class="fas fa-arrow-up text-purple-400"></i>
                    <span>Push</span>
                </button>
                <button class="command-btn" id="git-commit-btn" title="git commit">
                    <i class="fas fa-save text-purple-400"></i>
                    <span>Commit</span>
                </button>
            </div>
            <div id="utilities" class="ribbon-panel hidden space-x-4">
                <button class="command-btn" id="clear-terminal-btn" title="clear">
                    <i class="fas fa-eraser text-gray-400"></i>
                    <span>Clear</span>
                </button>
                <button class="command-btn" id="add-custom-command-btn" title="Add Custom Command">
                    <i class="fas fa-plus text-gray-400"></i>
                    <span>Custom Cmd</span>
                </button>
                <button class="command-btn" id="refresh-versions-btn" title="System Info">
                    <i class="fas fa-info text-gray-400"></i>
                    <span>System Info</span>
                </button>
            </div>
            <div id="cmd" class="ribbon-panel hidden space-x-4">
                <button class="command-btn" data-command="dir" title="dir / ls">
                    <i class="fas fa-list text-gray-400"></i>
                    <span>List Files</span>
                </button>
                <button class="command-btn" data-command="cls" title="cls / clear">
                    <i class="fas fa-terminal text-gray-400"></i>
                    <span>Clear Screen</span>
                </button>
                <button class="command-btn" data-command="ipconfig" title="ipconfig">
                    <i class="fas fa-network-wired text-gray-400"></i>
                    <span>IP Config</span>
                </button>
                <button class="command-btn" data-command="help" title="help">
                    <i class="fas fa-question-circle text-gray-400"></i>
                    <span>Help</span>
                </button>
            </div>
        </div>
    </header>

    <main class="flex flex-1 gap-5 p-5 bg-gray-900">
        <aside class="w-64 bg-gray-800 rounded-xl p-5 shadow-lg flex flex-col">
            <h2 class="font-bold text-lg text-gray-100 mb-4">Project Explorer</h2>
            <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition mb-5" id="select-folder-btn-main">
                Open Folder
            </button>

            <!-- Current project display -->
            <div id="current-project" class="mb-3 hidden">
                <div class="text-sm text-gray-400 mb-1">Current Project:</div>
                <div id="project-path" class="text-xs break-all"></div>
                <div id="project-type" class="text-xs text-blue-400 mt-1"></div>
            </div>

            <h3 class="text-xs text-gray-500 uppercase tracking-wide mb-2">Recent Projects</h3>
            <ul class="space-y-2 text-sm" id="recent-projects-list">
                <li class="p-3 hover:bg-gray-700 rounded-lg transition cursor-pointer flex items-center space-x-3">
                    <i class="fas fa-folder text-blue-400"></i>
                    <span>/my-flutter-app</span>
                </li>
                <li class="p-3 hover:bg-gray-700 rounded-lg transition cursor-pointer flex items-center space-x-3">
                    <i class="fas fa-folder text-blue-400"></i>
                    <span>/api-server-py</span>
                </li>
            </ul>
            <div class="mt-6">
                <h3 class="text-xs text-gray-500 uppercase tracking-wide mb-2">Current Folder</h3>
                <ul class="space-y-1 text-sm" id="current-folder-files">
                    <li class="file-item">
                        <i class="fas fa-folder text-gray-500 mr-2"></i>
                        <span>lib/</span>
                    </li>
                    <li class="file-item">
                        <i class="fas fa-file text-gray-500 mr-2"></i>
                        <span>main.dart</span>
                    </li>
                    <li class="file-item">
                        <i class="fas fa-file text-gray-500 mr-2"></i>
                        <span>pubspec.yaml</span>
                    </li>
                    <li class="file-item">
                        <i class="fas fa-file text-gray-500 mr-2"></i>
                        <span>README.md</span>
                    </li>
                </ul>
            </div>

            <!-- Editor integration section -->
            <div id="editor-section" class="mt-3 hidden">
                <div class="text-sm text-gray-400 mb-2">Open in Editor:</div>
                <div class="flex space-x-2">
                    <button id="open-vscode-btn" title="Open project in VS Code" class="text-xs px-2 py-1 rounded bg-gray-700 hover:bg-gray-600">VS Code</button>
                    <button id="open-studio-btn" title="Open project in Android Studio" class="text-xs px-2 py-1 rounded bg-gray-700 hover:bg-gray-600">Studio</button>
                    <button id="open-explorer-btn" title="Open project in file explorer" class="text-xs px-2 py-1 rounded bg-gray-700 hover:bg-gray-600">Explorer</button>
                </div>
            </div>
        </aside>

        <section class="flex flex-col flex-1 bg-gray-800 rounded-xl shadow-lg">
            <div class="flex items-center border-b border-gray-700 bg-gray-900 rounded-t-xl">
                <div class="flex">
                    <button class="p-3 text-gray-400 hover:text-white transition" id="new-terminal-btn" title="New Terminal">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                <button class="p-3 text-gray-400 hover:text-white transition ml-auto" id="show-history-btn" title="Show Command History">
                    <i class="fas fa-history"></i>
                </button>
            </div>
            <div id="terminal-container" class="flex-1 overflow-hidden bg-black">
                <div id="default-terminal" class="h-full w-full"></div>

                <!-- System versions display area -->
                <div id="system-versions" class="hidden mt-4 p-4 bg-gray-900 rounded-lg">
                    <h3 class="text-sm font-medium text-gray-300 mb-3">System Information</h3>
                    <div class="space-y-2 text-xs">
                        <div class="flex justify-between">
                            <span>Node.js:</span>
                            <span id="node-version" class="text-green-400">Checking...</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Git:</span>
                            <span id="git-version" class="text-green-400">Checking...</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Flutter:</span>
                            <span id="flutter-version" class="text-green-400">Checking...</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Python:</span>
                            <span id="python-version" class="text-green-400">Checking...</span>
                        </div>
                        <div class="flex justify-between">
                            <span>VS Code:</span>
                            <span id="vscode-version" class="text-green-400">Checking...</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <aside class="w-64 bg-gray-800 rounded-xl p-5 shadow-lg flex flex-col">
            <h2 class="font-bold text-lg text-gray-100 mb-4">Command History</h2>
            <div class="flex items-center justify-between mb-3">
                <input type="text" id="history-search" placeholder="Search commands..." class="text-xs px-2 py-1 rounded bg-gray-700 text-gray-300 flex-1 mr-2">
                <button id="clear-history-btn" class="text-xs px-2 py-1 rounded bg-red-600 hover:bg-red-700 text-white">Clear</button>
            </div>
            <div class="overflow-y-auto text-sm space-y-3" id="command-history-list">
                <div class="p-3 bg-gray-900 rounded-lg border-l-4 border-green-500">
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span class="flex items-center space-x-1">
                            <i class="fas fa-check-circle text-green-500"></i>
                            <span>Success</span>
                        </span>
                        <span>10:30 AM</span>
                    </div>
                    <p class="mt-1 font-mono text-gray-300">$ flutter run -d chrome</p>
                </div>
                <div class="p-3 bg-gray-900 rounded-lg border-l-4 border-red-500">
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span class="flex items-center space-x-1">
                            <i class="fas fa-times-circle text-red-500"></i>
                            <span>Error</span>
                        </span>
                        <span>10:35 AM</span>
                    </div>
                    <p class="mt-1 font-mono text-gray-300">$ python main.py</p>
                </div>
                <div class="history-empty text-gray-500 text-center py-4 hidden">No commands executed yet</div>
            </div>
            <div class="mt-4 flex space-x-2">
                <button id="export-history-btn" class="text-xs px-2 py-1 rounded bg-gray-700 hover:bg-gray-600 text-gray-300 flex-1">Export</button>
                <button id="toggle-history-btn" class="text-xs px-2 py-1 rounded bg-blue-600 hover:bg-blue-700 text-white">Auto-scroll</button>
            </div>
        </aside>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Modals -->
    <div id="modal-overlay" class="hidden"></div>

    <!-- Commit Modal -->
    <div id="commit-modal" class="hidden">
        <div class="modal-content">
            <h3>Commit Changes</h3>
            <div class="form-group">
                <label for="commit-message">Commit Message:</label>
                <textarea id="commit-message" placeholder="Enter commit message..." class="form-input" required></textarea>
                <div id="commit-message-error" class="error-message hidden">Commit message is required</div>
                <div class="character-count">
                    <span id="commit-message-count">0</span>/72 characters
                </div>
            </div>
            <div class="modal-buttons">
                <button id="cancel-commit" class="btn-secondary">Cancel</button>
                <button id="confirm-commit" class="btn-primary" disabled>Commit</button>
            </div>
        </div>
    </div>

    <!-- Branch Modal -->
    <div id="branch-modal" class="hidden">
        <div class="modal-content">
            <h3 id="branch-modal-title">Switch Branch</h3>
            <div class="form-group">
                <label for="branch-select">Select Branch:</label>
                <select id="branch-select">
                    <option value="">Loading branches...</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button id="cancel-branch">Cancel</button>
                <button id="confirm-branch">Switch</button>
            </div>
        </div>
    </div>

    <!-- Custom Command Modal -->
    <div id="custom-command-modal" class="hidden">
        <div class="modal-content">
            <h3 id="custom-command-modal-title">Add Custom Command</h3>
            <div class="form-group">
                <label for="command-name">Command Name:</label>
                <input type="text" id="command-name" placeholder="e.g., Run Tests" />
            </div>
            <div class="form-group">
                <label for="command-description">Description:</label>
                <input type="text" id="command-description" placeholder="e.g., Execute unit tests" />
            </div>
            <div class="form-group">
                <label for="command-shell">Shell Command:</label>
                <input type="text" id="command-shell" placeholder="e.g., npm test" />
            </div>
            <div class="form-group">
                <label for="command-icon">Icon (emoji):</label>
                <input type="text" id="command-icon" placeholder="e.g., ðŸ§ª" maxlength="2" />
            </div>
            <div class="modal-buttons">
                <button id="cancel-custom-command">Cancel</button>
                <button id="confirm-custom-command">Save</button>
            </div>
        </div>
    </div>

    <!-- Custom commands list for dynamic rendering -->
    <div id="custom-commands-list" class="hidden"></div>

    <!-- Toast notification container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 space-y-2"></div>

    <script>
        // RIBBON TAB SWITCH
        document.querySelectorAll('.ribbon-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove 'active' class from all tabs and hide all panels
                document.querySelectorAll('.ribbon-tab').forEach(t => {
                    t.classList.remove('active', 'bg-gray-700', 'text-white');
                    t.classList.add('text-gray-400', 'hover:bg-gray-700');
                });
                document.querySelectorAll('.ribbon-panel').forEach(p => p.classList.add('hidden'));

                // Add 'active' class to the clicked tab and show the corresponding panel
                tab.classList.remove('text-gray-400', 'hover:bg-gray-700');
                tab.classList.add('active', 'bg-gray-700', 'text-white');
                document.getElementById(tab.dataset.target).classList.remove('hidden');
            });
        });

        // THEME TOGGLE
        const html = document.documentElement;
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', () => {
                html.classList.toggle('dark');
                const isDark = html.classList.contains('dark');
                themeToggle.innerHTML = isDark
                    ? '<i class="fas fa-moon text-blue-400"></i>'
                    : '<i class="fas fa-sun text-yellow-400"></i>';
            });
        }

        // Basic functionality check
        try {
            if (typeof require === 'undefined') {
                console.error('NodeIntegration is not enabled');
            }
        } catch (error) {
            console.error('Error initializing renderer:', error);
        }
    </script>

    <script src="../dist/renderer/vendor.bundle.js"></script>
    <script src="../dist/renderer/app.bundle.js"></script>

    <script>
        window.addEventListener('DOMContentLoaded', () => {
            // DOM content loaded
        });

        window.addEventListener('load', () => {
            // Page fully loaded
        });

        // Error handlers
        window.addEventListener('error', (event) => {
            console.error('Global error in renderer:', event.message);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection in renderer:', event.reason);
        });
    </script>
</body>
</html>